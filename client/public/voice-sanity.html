<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Voice Sanity</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- If you use a CSP, loosen it for this page (uncomment and tune):
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self' https:;
                   script-src 'self' https://unpkg.com 'unsafe-inline';
                   connect-src 'self' https://api.elevenlabs.io https:;
                   frame-src https://*.elevenlabs.io https:;">
    -->
    <style>
      body { font-family: ui-sans-serif, system-ui; margin: 0; }
      .dock { position: fixed; right: 24px; bottom: 24px; z-index: 9999; }
      .bar { position: fixed; left: 0; right: 0; top: 0; padding: 10px; font-size: 12px;
             background: #0f172a; color: #e2e8f0; display: flex; gap: 12px; align-items: center; }
      .pill { border: 1px solid #475569; border-radius: 999px; padding: 4px 8px; }
      button { border-radius: 12px; padding: 8px 12px; border: 1px solid #cbd5e1; background: white; }
    </style>
  </head>
  <body>
    <div class="bar">
      <span class="pill">Voice sanity page — isolates the widget from your app</span>
      <button id="open">Open widget</button>
      <button id="close">Close widget</button>
      <span id="status" class="pill">status: loading…</span>
    </div>

    <!-- The actual web component -->
    <elevenlabs-convai
      id="el-agent"
      agent-id="agent_8201k251883jf0hr1ym7d6dbymxc"
      class="dock"
    ></elevenlabs-convai>

    <!-- Official SDK -->
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>

    <!-- Diagnostics -->
    <script>
      (function ready() {
        const el = document.getElementById('el-agent');
        const status = document.getElementById('status');
        if (!el || !el.addEventListener) return setTimeout(ready, 100);

        el.addEventListener('convai-ready',  () => { console.log('[EL] ready'); status.textContent = 'status: ready'; });
        el.addEventListener('convai-opened', () => { console.log('[EL] opened'); status.textContent = 'status: opened'; });
        el.addEventListener('convai-closed', () => { console.log('[EL] closed'); status.textContent = 'status: closed'; });
        el.addEventListener('convai-error',  e => { console.error('[EL] error', e.detail); status.textContent = 'status: error'; });

        document.getElementById('open').onclick  = () => el.dispatchEvent(new Event('convai-open'));
        document.getElementById('close').onclick = () => el.dispatchEvent(new Event('convai-close'));

        // If the SDK never upgraded the element (no shadowRoot) warn loudly
        setTimeout(() => {
          if (!el.shadowRoot) {
            console.error('[EL] widget not upgraded (no shadowRoot). Check domain allowlist, CSP, or SDK 404.');
            status.textContent = 'status: not upgraded (check console)';
          }
        }, 3000);
      })();
    </script>
  </body>
</html>